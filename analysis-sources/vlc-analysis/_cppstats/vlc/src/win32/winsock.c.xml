<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" revision="1.0.0" language="C" filename="D:\Pesquisa\Projects\vlc-analysis\_cppstats\vlc\src\win32\winsock.c"><cpp:if>#<cpp:directive>if</cpp:directive> <expr><call><name>defined</name><argument_list>(<argument><expr><name>HAVE_CONFIG_H</name></expr></argument>)</argument_list></call></expr></cpp:if>
<cpp:include>#<cpp:directive>include</cpp:directive> <cpp:file>"config.h"</cpp:file></cpp:include>

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<cpp:include>#<cpp:directive>include</cpp:directive> <cpp:file>&lt;vlc_common.h&gt;</cpp:file></cpp:include>

<cpp:include>#<cpp:directive>include</cpp:directive> <cpp:file>&lt;vlc_network.h&gt;</cpp:file></cpp:include>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><literal type="number">0</literal></expr></cpp:if>

ssize_t vlc_sendmsg (int s, struct msghdr *hdr, int flags)

{

if ((hdr-&gt;msg_iovlen &gt; 100) || (hdr-&gt;msg_controllen &gt; 0))

{

errno = EINVAL;

return -1;

}

WSABUF buf[hdr-&gt;msg_iovlen];

for (size_t i = 0; i &lt; sizeof (buf) / sizeof (buf[0]); i++)

buf[i].buf = hdr-&gt;msg_iov[i].iov_base,

buf[i].len = hdr-&gt;msg_iov[i].iov_len;

DWORD sent;

if (WSASendTo (s, buf, sizeof (buf) / sizeof (buf[0]), &amp;sent, flags,

hdr-&gt;msg_name, hdr-&gt;msg_namelen, NULL, NULL) == 0)

return sent;

return -1;

}

ssize_t vlc_recvmsg (int s, struct msghdr *hdr, int flags)

{

if (hdr-&gt;msg_iovlen &gt; 100)

{

errno = EINVAL;

return -1;

}

WSABUF buf[hdr-&gt;msg_iovlen];

for (size_t i = 0; i &lt; sizeof (buf) / sizeof (buf[0]); i++)

buf[i].buf = hdr-&gt;msg_iov[i].iov_base,

buf[i].len = hdr-&gt;msg_iov[i].iov_len;

DWORD recvd, dwFlags = flags;

INT fromlen = hdr-&gt;msg_namelen;

hdr-&gt;msg_controllen = 0;

hdr-&gt;msg_flags = 0;

int ret = WSARecvFrom (s, buf, sizeof (buf) / sizeof (buf[0]), &amp;recvd,

&amp;dwFlags, hdr-&gt;msg_name, &amp;fromlen, NULL, NULL);

hdr-&gt;msg_namelen = fromlen;

hdr-&gt;msg_flags = dwFlags;

if (ret == 0)

return recvd;

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><call><name>defined</name><argument_list>(<argument><expr><name>MSG_TRUNC</name></expr></argument>)</argument_list></call></expr></cpp:if>
if (WSAGetLastError() == WSAEMSGSIZE)

{

hdr-&gt;msg_flags |= MSG_TRUNC;

return recvd;

}

<cpp:else>#<cpp:directive>else</cpp:directive></cpp:else>

<cpp:warning>#<cpp:directive>warning</cpp:directive> Out-of-date Winsock header files!</cpp:warning>

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

return -1;

}

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

</unit>
