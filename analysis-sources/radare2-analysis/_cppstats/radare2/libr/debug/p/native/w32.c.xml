<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" revision="1.0.0" language="C" filename="D:\Pesquisa\Projects\radare2-analysis\_cppstats\radare2\libr\debug\p\native\w32.c"><cpp:include>#<cpp:directive>include</cpp:directive> <cpp:file>"w32.h"</cpp:file></cpp:include>

<function><type><specifier>static</specifier> <name>bool</name></type> <name>w32dbg_SeDebugPrivilege</name><parameter_list>()</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>bool</name></type> <name>ret</name> <init>= <expr><name>true</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>TOKEN_PRIVILEGES</name></type> <name>tokenPriv</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>hToken</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>LUID</name></type> <name>luidDebug</name></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>OpenProcessToken</name> <argument_list>(<argument><expr><call><name>GetCurrentProcess</name> <argument_list>()</argument_list></call></expr></argument>,

<argument><expr><name>TOKEN_ADJUST_PRIVILEGES</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>hToken</name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>

<return>return <expr><name>false</name></expr>;</return></block_content></block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>LookupPrivilegeValue</name> <argument_list>(<argument><expr><name>NULL</name></expr></argument>, <argument><expr><name>SE_DEBUG_NAME</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>luidDebug</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>hToken</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>false</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name><name>tokenPriv</name><operator>.</operator><name>PrivilegeCount</name></name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt>

<expr_stmt><expr><name><name>tokenPriv</name><operator>.</operator><name>Privileges</name><index>[<expr><literal type="number">0</literal></expr>]</index></name><operator>.</operator><name>Luid</name> <operator>=</operator> <name>luidDebug</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>tokenPriv</name><operator>.</operator><name>Privileges</name><index>[<expr><literal type="number">0</literal></expr>]</index></name><operator>.</operator><name>Attributes</name> <operator>=</operator> <name>SE_PRIVILEGE_ENABLED</name></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><call><name>AdjustTokenPrivileges</name> <argument_list>(<argument><expr><name>hToken</name></expr></argument>, <argument><expr><name>FALSE</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>tokenPriv</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name>NULL</name></expr></argument>, <argument><expr><name>NULL</name></expr></argument>)</argument_list></call> <operator>!=</operator> <name>FALSE</name></expr>)</condition> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name><name>tokenPriv</name><operator>.</operator><name>Privileges</name><index>[<expr><literal type="number">0</literal></expr>]</index></name><operator>.</operator><name>Attributes</name> <operator>==</operator> <name>SE_PRIVILEGE_ENABLED</name></expr>)</condition> <block>{<block_content>

</block_content>}</block></if></if_stmt>

</block_content>}</block></if> <else>else <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"Failed to change token privileges 0x%x\n"</literal></expr></argument>, <argument><expr><operator>(</operator><name>int</name><operator>)</operator><call><name>GetLastError</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>false</name></expr>;</expr_stmt>

</block_content>}</block></else></if_stmt>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>hToken</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>ret</name></expr>;</return>

</block_content>}</block></function>

<function><type><name>int</name></type> <name>w32_dbg_init</name><parameter_list>()</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>lib</name></decl>;</decl_stmt>

<expr_stmt><expr><call><name>w32dbg_SeDebugPrivilege</name> <argument_list>()</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_DebugActiveProcessStop</name> <operator>=</operator> <operator>(</operator><call><call><name>BOOL</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>,

<argument><expr><literal type="string">"DebugActiveProcessStop"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_OpenThread</name> <operator>=</operator> <operator>(</operator><call><call><name>HANDLE</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>DWORD</name></expr></argument>, <argument><expr><name>BOOL</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"OpenThread"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_OpenProcess</name> <operator>=</operator> <operator>(</operator><call><call><name>HANDLE</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>DWORD</name></expr></argument>, <argument><expr><name>BOOL</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"OpenProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_DebugBreakProcess</name> <operator>=</operator> <operator>(</operator><call><call><name>BOOL</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>,

<argument><expr><literal type="string">"DebugBreakProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_CreateToolhelp32Snapshot</name> <operator>=</operator> <operator>(</operator><call><call><name>HANDLE</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>DWORD</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>,

<argument><expr><literal type="string">"CreateToolhelp32Snapshot"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_GetThreadId</name> <operator>=</operator> <operator>(</operator><call><call><name>DWORD</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"GetThreadId"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_GetProcessId</name> <operator>=</operator> <operator>(</operator><call><call><name>DWORD</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"GetProcessId"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_QueryFullProcessImageName</name> <operator>=</operator> <operator>(</operator><call><call><name>BOOL</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>, <argument><expr><name>LPTSTR</name></expr></argument>, <argument><expr><name>PDWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><call><name>W32_TCALL</name> <argument_list>(<argument><expr><literal type="string">"QueryFullProcessImageName"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_GetEnabledXStateFeatures</name> <operator>=</operator> <operator>(</operator><call><call><name>ut64</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call> <argument_list>()</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name><argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"GetEnabledXStateFeatures"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_InitializeContext</name> <operator>=</operator> <operator>(</operator><call><call><name>BOOL</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call> <argument_list>(<argument><expr><name>PVOID</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>, <argument><expr><name>PCONTEXT</name><operator>*</operator></expr></argument>, <argument><expr><name>PDWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name><argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"InitializeContext"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_GetXStateFeaturesMask</name> <operator>=</operator> <operator>(</operator><macro><name>BOOL</name> <argument_list>(<argument>WINAPI *</argument>)</argument_list></macro> <operator>(</operator><name>PCONTEXT</name> <name>Context</name><operator>,</operator> <name>PDWORD64</name><operator>)</operator><operator>)</operator>

<call><name>GetProcAddress</name><argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"GetXStateFeaturesMask"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_LocateXStateFeature</name> <operator>=</operator> <operator>(</operator><macro><name>PVOID</name> <argument_list>(<argument>WINAPI *</argument>)</argument_list></macro> <operator>(</operator><name>PCONTEXT</name> <name>Context</name><operator>,</operator> <name>DWORD</name> <operator>,</operator><name>PDWORD</name><operator>)</operator><operator>)</operator>

<call><name>GetProcAddress</name><argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"LocateXStateFeature"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_SetXStateFeaturesMask</name> <operator>=</operator> <operator>(</operator><macro><name>BOOL</name> <argument_list>(<argument>WINAPI *</argument>)</argument_list></macro> <operator>(</operator><name>PCONTEXT</name> <name>Context</name><operator>,</operator> <name>DWORD64</name><operator>)</operator><operator>)</operator>

<call><name>GetProcAddress</name><argument_list>(<argument><expr><call><name>GetModuleHandle</name> <argument_list>(<argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"kernel32"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>, <argument><expr><literal type="string">"SetXStateFeaturesMask"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>lib</name> <operator>=</operator> <call><name>LoadLibrary</name> <argument_list>(<argument><expr><call><name>TEXT</name><argument_list>(<argument><expr><literal type="string">"psapi.dll"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if<condition>(<expr><operator>!</operator><name>lib</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"Cannot load psapi.dll. Aborting\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>false</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>w32_GetMappedFileName</name> <operator>=</operator> <operator>(</operator><call><call><name>DWORD</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>LPVOID</name></expr></argument>, <argument><expr><name>LPTSTR</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><name>lib</name></expr></argument>, <argument><expr><call><name>W32_TCALL</name> <argument_list>(<argument><expr><literal type="string">"GetMappedFileName"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_GetModuleBaseName</name> <operator>=</operator> <operator>(</operator><call><call><name>DWORD</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>HMODULE</name></expr></argument>, <argument><expr><name>LPTSTR</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><name>lib</name></expr></argument>, <argument><expr><call><name>W32_TCALL</name> <argument_list>(<argument><expr><literal type="string">"GetModuleBaseName"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_GetModuleInformation</name> <operator>=</operator> <operator>(</operator><call><call><name>BOOL</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>HMODULE</name></expr></argument>, <argument><expr><name>LPMODULEINFO</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><name>lib</name></expr></argument>, <argument><expr><literal type="string">"GetModuleInformation"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_GetModuleFileNameEx</name> <operator>=</operator> <operator>(</operator><call><call><name>DWORD</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>HMODULE</name></expr></argument>, <argument><expr><name>LPTSTR</name></expr></argument>, <argument><expr><name>DWORD</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><name>lib</name></expr></argument>, <argument><expr><call><name>W32_TCALL</name> <argument_list>(<argument><expr><literal type="string">"GetModuleFileNameEx"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>lib</name> <operator>=</operator> <call><name>LoadLibrary</name> <argument_list>(<argument><expr><call><name>TEXT</name><argument_list>(<argument><expr><literal type="string">"ntdll.dll"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_NtQuerySystemInformation</name> <operator>=</operator> <operator>(</operator><call><call><name>NTSTATUS</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>ULONG</name></expr></argument>, <argument><expr><name>PVOID</name></expr></argument>, <argument><expr><name>ULONG</name></expr></argument>, <argument><expr><name>PULONG</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><name>lib</name></expr></argument>, <argument><expr><literal type="string">"NtQuerySystemInformation"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_NtDuplicateObject</name> <operator>=</operator> <operator>(</operator><call><call><name>NTSTATUS</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>PHANDLE</name></expr></argument>, <argument><expr><name>ACCESS_MASK</name></expr></argument>, <argument><expr><name>ULONG</name></expr></argument>, <argument><expr><name>ULONG</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><name>lib</name></expr></argument>, <argument><expr><literal type="string">"NtDuplicateObject"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_NtQueryObject</name> <operator>=</operator> <operator>(</operator><call><call><name>NTSTATUS</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>ULONG</name></expr></argument>, <argument><expr><name>PVOID</name></expr></argument>, <argument><expr><name>ULONG</name></expr></argument>, <argument><expr><name>PULONG</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name><argument_list>(<argument><expr><name>lib</name></expr></argument>,<argument><expr><literal type="string">"NtQueryObject"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>w32_NtQueryInformationThread</name> <operator>=</operator> <operator>(</operator><call><call><name>NTSTATUS</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call><argument_list>(<argument><expr><name>HANDLE</name></expr></argument>, <argument><expr><name>ULONG</name></expr></argument>, <argument><expr><name>PVOID</name></expr></argument>, <argument><expr><name>ULONG</name></expr></argument>, <argument><expr><name>PULONG</name></expr></argument>)</argument_list></call><operator>)</operator>

<call><name>GetProcAddress</name> <argument_list>(<argument><expr><name>lib</name></expr></argument>, <argument><expr><literal type="string">"NtQueryInformationThread"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>w32_DebugActiveProcessStop</name> <operator>||</operator> <operator>!</operator><name>w32_OpenThread</name> <operator>||</operator> <operator>!</operator><name>w32_DebugBreakProcess</name> <operator>||</operator>

<operator>!</operator><name>w32_GetModuleBaseName</name> <operator>||</operator> <operator>!</operator><name>w32_GetModuleInformation</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"debug_init_calls:\n"</literal>

<literal type="string">"DebugActiveProcessStop: 0x%p\n"</literal>

<literal type="string">"OpenThread: 0x%p\n"</literal>

<literal type="string">"DebugBreakProcess: 0x%p\n"</literal>

<literal type="string">"GetThreadId: 0x%p\n"</literal></expr></argument>,

<argument><expr><name>w32_DebugActiveProcessStop</name></expr></argument>, <argument><expr><name>w32_OpenThread</name></expr></argument>, <argument><expr><name>w32_DebugBreakProcess</name></expr></argument>, <argument><expr><name>w32_GetThreadId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>false</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<return>return <expr><name>true</name></expr>;</return>

</block_content>}</block></function>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><literal type="number">0</literal></expr></cpp:if>

static HANDLE w32_t2h(pid_t tid) {

TH_INFO *th = get_th (tid);

if(!th) {

w32_dbg_threads (tid);

if(!(th = get_th (tid)))

return NULL;

}

return th-&gt;ht;

}

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<function><type><specifier>inline</specifier> <specifier>static</specifier> <name>int</name></type> <name>w32_h2t</name><parameter_list>(<parameter><decl><type><name>HANDLE</name></type> <name>h</name></decl></parameter>)</parameter_list> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name>w32_GetThreadId</name> <operator>!=</operator> <name>NULL</name></expr>)</condition><block type="pseudo"><block_content> 

<return>return <expr><call><name>w32_GetThreadId</name> <argument_list>(<argument><expr><name>h</name></expr></argument>)</argument_list></call></expr>;</return></block_content></block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><name>w32_GetProcessId</name> <operator>!=</operator> <name>NULL</name></expr>)</condition><block type="pseudo"><block_content> 

<return>return <expr><call><name>w32_GetProcessId</name> <argument_list>(<argument><expr><name>h</name></expr></argument>)</argument_list></call></expr>;</return></block_content></block></if></if_stmt>

<return>return <expr><operator>(</operator><name>int</name><operator>)</operator><operator>(</operator><name>size_t</name><operator>)</operator><name>h</name></expr>;</return> 

</block_content>}</block></function>

<function><type><specifier>static</specifier> <specifier>inline</specifier> <name>int</name></type> <name>w32_h2p</name><parameter_list>(<parameter><decl><type><name>HANDLE</name></type> <name>h</name></decl></parameter>)</parameter_list> <block>{<block_content>

<return>return <expr><call><name>w32_GetProcessId</name> <argument_list>(<argument><expr><name>h</name></expr></argument>)</argument_list></call></expr>;</return>

</block_content>}</block></function>

<function><type><name>int</name></type> <name>w32_first_thread</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>pid</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>th</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>thid</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>THREADENTRY32</name></type> <name>te32</name></decl>;</decl_stmt>

<expr_stmt><expr><name><name>te32</name><operator>.</operator><name>dwSize</name></name> <operator>=</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>THREADENTRY32</name></expr></argument>)</argument_list></sizeof></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>w32_OpenThread</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name><argument_list>(<argument><expr><literal type="string">"w32_thread_list: no w32_OpenThread?\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>th</name> <operator>=</operator> <call><name>CreateToolhelp32Snapshot</name> <argument_list>(<argument><expr><name>TH32CS_SNAPTHREAD</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>th</name> <operator>==</operator> <name>INVALID_HANDLE_VALUE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"w32_thread_list: invalid handle\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>Thread32First</name> <argument_list>(<argument><expr><name>th</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>te32</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>th</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"w32_thread_list: no thread first\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<do>do <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name><name>te32</name><operator>.</operator><name>th32OwnerProcessID</name></name> <operator>==</operator> <name>pid</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>thid</name> <operator>=</operator> <call><name>w32_OpenThread</name> <argument_list>(<argument><expr><name>THREAD_ALL_ACCESS</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name><name>te32</name><operator>.</operator><name>th32ThreadID</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>thid</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_first_thread/OpenThread"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_load_th</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>th</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name><name>te32</name><operator>.</operator><name>th32ThreadID</name></name></expr>;</return>

</block_content>}</block></if></if_stmt>

</block_content>}</block> while <condition>(<expr><call><name>Thread32Next</name> <argument_list>(<argument><expr><name>th</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>te32</name></expr></argument>)</argument_list></call></expr>)</condition>;</do>

<label><name>err_load_th</name>:</label>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"Could not find an active thread for pid %d\n"</literal></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>th</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>pid</name></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>char</name> <modifier>*</modifier></type><name>get_w32_excep_name</name><parameter_list>(<parameter><decl><type><name>unsigned</name> <name>long</name></type> <name>code</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>char</name> <modifier>*</modifier></type><name>desc</name></decl>;</decl_stmt>

<switch>switch <condition>(<expr><name>code</name></expr>)</condition> <block>{<block_content>

<case>case <expr><name>EXCEPTION_ACCESS_VIOLATION</name></expr>:</case>

<expr_stmt><expr><name>desc</name> <operator>=</operator> <literal type="string">"access violation"</literal></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>EXCEPTION_ARRAY_BOUNDS_EXCEEDED</name></expr>:</case>

<expr_stmt><expr><name>desc</name> <operator>=</operator> <literal type="string">"array bounds exceeded"</literal></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>EXCEPTION_ILLEGAL_INSTRUCTION</name></expr>:</case>

<expr_stmt><expr><name>desc</name> <operator>=</operator> <literal type="string">"illegal instruction"</literal></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>EXCEPTION_INT_DIVIDE_BY_ZERO</name></expr>:</case>

<expr_stmt><expr><name>desc</name> <operator>=</operator> <literal type="string">"divide by zero"</literal></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>EXCEPTION_STACK_OVERFLOW</name></expr>:</case>

<expr_stmt><expr><name>desc</name> <operator>=</operator> <literal type="string">"stack overflow"</literal></expr>;</expr_stmt>

<break>break;</break>

<default>default:</default>

<expr_stmt><expr><name>desc</name> <operator>=</operator> <literal type="string">"unknown"</literal></expr>;</expr_stmt>

</block_content>}</block></switch>

<return>return <expr><name>desc</name></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>int</name></type> <name>debug_exception_event</name> <parameter_list>(<parameter><decl><type><name>DEBUG_EVENT</name> <modifier>*</modifier></type><name>de</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>unsigned</name> <name>long</name></type> <name>code</name> <init>= <expr><name><name>de</name><operator>-&gt;</operator><name>u</name><operator>.</operator><name>Exception</name><operator>.</operator><name>ExceptionRecord</name><operator>.</operator><name>ExceptionCode</name></name></expr></init></decl>;</decl_stmt>

<switch>switch <condition>(<expr><name>code</name></expr>)</condition> <block>{<block_content>

<case>case <expr><name>EXCEPTION_ACCESS_VIOLATION</name></expr>:</case>

<case>case <expr><name>EXCEPTION_ARRAY_BOUNDS_EXCEEDED</name></expr>:</case>

<case>case <expr><name>EXCEPTION_ILLEGAL_INSTRUCTION</name></expr>:</case>

<case>case <expr><name>EXCEPTION_INT_DIVIDE_BY_ZERO</name></expr>:</case>

<case>case <expr><name>EXCEPTION_STACK_OVERFLOW</name></expr>:</case>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"(%d) Fatal exception (%s) in thread %d\n"</literal></expr></argument>,

<argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>-&gt;</operator><name>dwProcessId</name></name></expr></argument>,

<argument><expr><call><name>get_w32_excep_name</name><argument_list>(<argument><expr><name>code</name></expr></argument>)</argument_list></call></expr></argument>,

<argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>-&gt;</operator><name>dwThreadId</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><literal type="number">0x406D1388</literal></expr>:</case>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"(%d) MS_VC_EXCEPTION (%x) in thread %d\n"</literal></expr></argument>,

<argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>-&gt;</operator><name>dwProcessId</name></name></expr></argument>, <argument><expr><operator>(</operator><name>int</name><operator>)</operator><name>code</name></expr></argument>, <argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>-&gt;</operator><name>dwThreadId</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><literal type="number">1</literal></expr>;</return>

<default>default:</default>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"(%d) Unknown exception %x in thread %d\n"</literal></expr></argument>,

<argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>-&gt;</operator><name>dwProcessId</name></name></expr></argument>, <argument><expr><operator>(</operator><name>int</name><operator>)</operator><name>code</name></expr></argument>, <argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>-&gt;</operator><name>dwThreadId</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<break>break;</break>

</block_content>}</block></switch>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>char</name> <modifier>*</modifier></type><name>get_file_name_from_handle</name> <parameter_list>(<parameter><decl><type><name>HANDLE</name></type> <name>handle_file</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>handle_file_map</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>LPTSTR</name></type> <name>filename</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>file_size_high</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>LPVOID</name></type> <name>map</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>file_size_low</name> <init>= <expr><call><name>GetFileSize</name> <argument_list>(<argument><expr><name>handle_file</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>file_size_high</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>file_size_low</name> <operator>==</operator> <literal type="number">0</literal> <operator>&amp;&amp;</operator> <name>file_size_high</name> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<return>return <expr><name>NULL</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>handle_file_map</name> <operator>=</operator> <call><name>CreateFileMapping</name> <argument_list>(<argument><expr><name>handle_file</name></expr></argument>, <argument><expr><name>NULL</name></expr></argument>, <argument><expr><name>PAGE_READONLY</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>, <argument><expr><name>NULL</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>handle_file_map</name></expr>)</condition> <block>{<block_content>

<goto>goto <name>err_get_file_name_from_handle</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>filename</name> <operator>=</operator> <call><name>malloc</name> <argument_list>(<argument><expr><operator>(</operator><name>MAX_PATH</name> <operator>+</operator> <literal type="number">1</literal><operator>)</operator> <operator>*</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>TCHAR</name></expr></argument>)</argument_list></sizeof></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>filename</name></expr>)</condition> <block>{<block_content>

<goto>goto <name>err_get_file_name_from_handle</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>map</name> <operator>=</operator> <call><name>MapViewOfFile</name> <argument_list>(<argument><expr><name>handle_file_map</name></expr></argument>, <argument><expr><name>FILE_MAP_READ</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>map</name> <operator>||</operator> <operator>!</operator><call><name>w32_GetMappedFileName</name> <argument_list>(<argument><expr><call><name>GetCurrentProcess</name> <argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>map</name></expr></argument>, <argument><expr><name>filename</name></expr></argument>, <argument><expr><name>MAX_PATH</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<goto>goto <name>err_get_file_name_from_handle</name>;</goto>

</block_content>}</block></if></if_stmt>

<decl_stmt><decl><type><name>TCHAR</name></type> <name><name>temp_buffer</name><index>[<expr><literal type="number">512</literal></expr>]</index></name></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>GetLogicalDriveStrings</name> <argument_list>(<argument><expr><sizeof>sizeof <argument_list>(<argument><expr><name>temp_buffer</name></expr></argument>)</argument_list></sizeof> <operator>-</operator> <literal type="number">1</literal></expr></argument>, <argument><expr><name>temp_buffer</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<goto>goto <name>err_get_file_name_from_handle</name>;</goto>

</block_content>}</block></if></if_stmt>

<decl_stmt><decl><type><name>TCHAR</name></type> <name><name>name</name><index>[<expr><name>MAX_PATH</name></expr>]</index></name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>TCHAR</name></type> <name><name>drive</name><index>[<expr><literal type="number">3</literal></expr>]</index></name> <init>= <expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">" :"</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>LPTSTR</name></type> <name>cur_drive</name> <init>= <expr><name>temp_buffer</name></expr></init></decl>;</decl_stmt>

<while>while <condition>(<expr><operator>*</operator><name>cur_drive</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><operator>*</operator><name>drive</name> <operator>=</operator> <operator>*</operator><name>cur_drive</name></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><call><name>QueryDosDevice</name> <argument_list>(<argument><expr><name>drive</name></expr></argument>, <argument><expr><name>name</name></expr></argument>, <argument><expr><name>MAX_PATH</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<decl_stmt><decl><type><name>size_t</name></type> <name>name_length</name> <init>= <expr><call><name>_tcslen</name> <argument_list>(<argument><expr><name>name</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>name_length</name> <operator>&lt;</operator> <name>MAX_PATH</name></expr>)</condition> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><call><name>_tcsnicmp</name> <argument_list>(<argument><expr><name>filename</name></expr></argument>, <argument><expr><name>name</name></expr></argument>, <argument><expr><name>name_length</name></expr></argument>)</argument_list></call> <operator>==</operator> <literal type="number">0</literal>

<operator>&amp;&amp;</operator> <operator>*</operator><operator>(</operator><name>filename</name> <operator>+</operator> <name>name_length</name><operator>)</operator> <operator>==</operator> <call><name>TEXT</name> <argument_list>(<argument><expr><literal type="char">'\\'</literal></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<decl_stmt><decl><type><name>TCHAR</name></type> <name><name>temp_filename</name><index>[<expr><name>MAX_PATH</name></expr>]</index></name></decl>;</decl_stmt>

<expr_stmt><expr><call><name>_sntprintf</name> <argument_list>(<argument><expr><name>temp_filename</name></expr></argument>, <argument><expr><name>MAX_PATH</name></expr></argument>, <argument><expr><call><name>TEXT</name> <argument_list>(<argument><expr><literal type="string">"%s%s"</literal></expr></argument>)</argument_list></call></expr></argument>,

<argument><expr><name>drive</name></expr></argument>, <argument><expr><name>filename</name> <operator>+</operator> <name>name_length</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>_tcsncpy</name> <argument_list>(<argument><expr><name>filename</name></expr></argument>, <argument><expr><name>temp_filename</name></expr></argument>,

<argument><expr><call><name>_tcslen</name> <argument_list>(<argument><expr><name>temp_filename</name></expr></argument>)</argument_list></call> <operator>+</operator> <literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<break>break;</break>

</block_content>}</block></if></if_stmt>

</block_content>}</block></if></if_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>cur_drive</name><operator>++</operator></expr>;</expr_stmt>

</block_content>}</block></while>

<label><name>err_get_file_name_from_handle</name>:</label>

<if_stmt><if>if <condition>(<expr><name>map</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>UnmapViewOfFile</name> <argument_list>(<argument><expr><name>map</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><name>handle_file_map</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>handle_file_map</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><name>filename</name></expr>)</condition> <block>{<block_content>

<decl_stmt><decl><type><name>char</name> <modifier>*</modifier></type><name>filename_</name> <init>= <expr><call><name>r_sys_conv_win_to_utf8</name><argument_list>(<argument><expr><name>filename</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>filename</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>filename_</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<return>return <expr><name>NULL</name></expr>;</return>

</block_content>}</block></function>

<decl_stmt><decl><type><name>LPVOID</name></type> <name>lstLib</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>PLIB_ITEM</name></type> <name>lstLibPtr</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<function><type><specifier>static</specifier> <name>PLIB_ITEM</name></type> <name>r_debug_get_lib_item</name><parameter_list>()</parameter_list> <block>{<block_content>

<return>return <expr><name>lstLibPtr</name></expr>;</return>

</block_content>}</block></function>

<cpp:define>#<cpp:directive>define</cpp:directive> <cpp:macro><name>PLIB_MAX</name></cpp:macro> <cpp:value>512</cpp:value></cpp:define>

<function><type><specifier>static</specifier> <name>void</name></type> <name>r_debug_lstLibAdd</name><parameter_list>(<parameter><decl><type><name>DWORD</name></type> <name>pid</name></decl></parameter>,<parameter><decl><type><name>LPVOID</name></type> <name>lpBaseOfDll</name></decl></parameter>, <parameter><decl><type><name>HANDLE</name></type> <name>hFile</name></decl></parameter>,<parameter><decl><type><name>char</name> <modifier>*</modifier></type> <name>dllname</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>int</name></type> <name>x</name></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>lstLib</name> <operator>==</operator> <literal type="number">0</literal></expr>)</condition><block type="pseudo"><block_content>

<expr_stmt><expr><name>lstLib</name> <operator>=</operator> <call><name>VirtualAlloc</name> <argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name>PLIB_MAX</name> <operator>*</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>LIB_ITEM</name></expr></argument>)</argument_list></sizeof></expr></argument>, <argument><expr><name>MEM_COMMIT</name></expr></argument>, <argument><expr><name>PAGE_READWRITE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>

<expr_stmt><expr><name>lstLibPtr</name> <operator>=</operator> <operator>(</operator><name>PLIB_ITEM</name><operator>)</operator><name>lstLib</name></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>x</name><operator>=</operator><literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name><operator>&lt;</operator><name>PLIB_MAX</name></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name><name>lstLibPtr</name><operator>-&gt;</operator><name>hFile</name></name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name><name>lstLibPtr</name><operator>-&gt;</operator><name>pid</name></name> <operator>=</operator> <name>pid</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>lstLibPtr</name><operator>-&gt;</operator><name>hFile</name></name> <operator>=</operator> <name>hFile</name></expr>;</expr_stmt> 

<expr_stmt><expr><name><name>lstLibPtr</name><operator>-&gt;</operator><name>BaseOfDll</name></name> <operator>=</operator> <name>lpBaseOfDll</name></expr>;</expr_stmt>

<expr_stmt><expr><call><name>strncpy</name> <argument_list>(<argument><expr><name><name>lstLibPtr</name><operator>-&gt;</operator><name>Path</name></name></expr></argument>,<argument><expr><name>dllname</name></expr></argument>,<argument><expr><name>MAX_PATH</name><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>i</name> <init>= <expr><call><name>strlen</name> <argument_list>(<argument><expr><name>dllname</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>n</name> <init>= <expr><name>i</name></expr></init></decl>;</decl_stmt>

<while>while<condition>(<expr><name><name>dllname</name><index>[<expr><name>i</name></expr>]</index></name> <operator>!=</operator> <literal type="char">'\\'</literal> <operator>&amp;&amp;</operator> <name>i</name> <operator>&gt;=</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>i</name><operator>--</operator></expr>;</expr_stmt>

</block_content>}</block></while>

<expr_stmt><expr><call><name>strncpy</name> <argument_list>(<argument><expr><name><name>lstLibPtr</name><operator>-&gt;</operator><name>Name</name></name></expr></argument>, <argument><expr><operator>&amp;</operator><name><name>dllname</name><index>[<expr><name>i</name><operator>+</operator><literal type="number">1</literal></expr>]</index></name></expr></argument>, <argument><expr><name>n</name><operator>-</operator><name>i</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>lstLibPtr</name><operator>++</operator></expr>;</expr_stmt>

</block_content>}</block></for>

<expr_stmt><expr><call><name>eprintf</name><argument_list>(<argument><expr><literal type="string">"r_debug_lstLibAdd: Cannot find slot\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>void</name> <modifier>*</modifier></type> <name>r_debug_findlib</name> <parameter_list>(<parameter><decl><type><name>void</name> <modifier>*</modifier></type> <name>BaseOfDll</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>PLIB_ITEM</name></type> <name>libPtr</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>lstLib</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>libPtr</name> <operator>=</operator> <operator>(</operator><name>PLIB_ITEM</name><operator>)</operator><name>lstLib</name></expr>;</expr_stmt>

<while>while <condition>(<expr><name><name>libPtr</name><operator>-&gt;</operator><name>hFile</name></name> <operator>!=</operator> <name>NULL</name></expr>)</condition> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name><name>libPtr</name><operator>-&gt;</operator><name>hFile</name></name> <operator>!=</operator> <operator>(</operator><name>HANDLE</name><operator>)</operator><operator>-</operator><literal type="number">1</literal></expr>)</condition><block type="pseudo"><block_content>

<if_stmt><if>if <condition>(<expr><name><name>libPtr</name><operator>-&gt;</operator><name>BaseOfDll</name></name> <operator>==</operator> <name>BaseOfDll</name></expr>)</condition><block type="pseudo"><block_content>

<return>return <expr><operator>(</operator><operator>(</operator><name>void</name><operator>*</operator><operator>)</operator><name>libPtr</name><operator>)</operator></expr>;</return></block_content></block></if></if_stmt></block_content></block></if></if_stmt>

<expr_stmt><expr><name>libPtr</name> <operator>=</operator> <operator>(</operator><name>PLIB_ITEM</name><operator>)</operator><operator>(</operator><operator>(</operator><name>ULONG_PTR</name><operator>)</operator><name>libPtr</name> <operator>+</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>LIB_ITEM</name></expr></argument>)</argument_list></sizeof><operator>)</operator></expr>;</expr_stmt>

</block_content>}</block></while>

</block_content>}</block></if></if_stmt>

<return>return <expr><name>NULL</name></expr>;</return>

</block_content>}</block></function>

<decl_stmt><decl><type><name>LPVOID</name></type> <name>lstThread</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>PTHREAD_ITEM</name></type> <name>lstThreadPtr</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<function><type><specifier>static</specifier> <name>PTHREAD_ITEM</name></type> <name>r_debug_get_thread_item</name> <parameter_list>()</parameter_list> <block>{<block_content>

<return>return <expr><name>lstThreadPtr</name></expr>;</return>

</block_content>}</block></function>

<cpp:define>#<cpp:directive>define</cpp:directive> <cpp:macro><name>PTHREAD_MAX</name></cpp:macro> <cpp:value>1024</cpp:value></cpp:define>

<function><type><specifier>static</specifier> <name>void</name></type> <name>r_debug_lstThreadAdd</name> <parameter_list>(<parameter><decl><type><name>DWORD</name></type> <name>pid</name></decl></parameter>, <parameter><decl><type><name>DWORD</name></type> <name>tid</name></decl></parameter>, <parameter><decl><type><name>HANDLE</name></type> <name>hThread</name></decl></parameter>, <parameter><decl><type><name>LPVOID</name></type> <name>lpThreadLocalBase</name></decl></parameter>, <parameter><decl><type><name>LPVOID</name></type> <name>lpStartAddress</name></decl></parameter>, <parameter><decl><type><name>BOOL</name></type> <name>bFinished</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>int</name></type> <name>x</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>PVOID</name></type> <name>startAddress</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>lstThread</name> <operator>==</operator> <literal type="number">0</literal></expr>)</condition><block type="pseudo"><block_content>

<expr_stmt><expr><name>lstThread</name> <operator>=</operator> <call><name>VirtualAlloc</name> <argument_list>(<argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name>PTHREAD_MAX</name> <operator>*</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>THREAD_ITEM</name></expr></argument>)</argument_list></sizeof></expr></argument>, <argument><expr><name>MEM_COMMIT</name></expr></argument>, <argument><expr><name>PAGE_READWRITE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>

<expr_stmt><expr><name>lstThreadPtr</name> <operator>=</operator> <operator>(</operator><name>PTHREAD_ITEM</name><operator>)</operator><name>lstThread</name></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <name>PTHREAD_MAX</name></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>tid</name></name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>pid</name></name> <operator>=</operator> <name>pid</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>tid</name></name> <operator>=</operator> <name>tid</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>bFinished</name></name> <operator>=</operator> <name>bFinished</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>hThread</name></name> <operator>=</operator> <name>hThread</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>lpThreadLocalBase</name></name> <operator>=</operator> <name>lpThreadLocalBase</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>lpStartAddress</name></name> <operator>=</operator> <name>lpStartAddress</name></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><call><name>w32_NtQueryInformationThread</name> <argument_list>(<argument><expr><name>hThread</name></expr></argument>, <argument><expr><literal type="number">0x9</literal></expr></argument> , <argument><expr><operator>&amp;</operator><name>startAddress</name></expr></argument>, <argument><expr><sizeof>sizeof <argument_list>(<argument><expr><name>PVOID</name></expr></argument>)</argument_list></sizeof></expr></argument>, <argument><expr><name>NULL</name></expr></argument>)</argument_list></call> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>lpThreadEntryPoint</name></name> <operator>=</operator> <name>startAddress</name></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<return>return;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>lstThreadPtr</name><operator>++</operator></expr>;</expr_stmt>

</block_content>}</block></for>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"r_debug_lstThreadAdd: Cannot find slot\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>void</name> <modifier>*</modifier></type> <name>r_debug_findthread</name> <parameter_list>(<parameter><decl><type><name>int</name></type> <name>pid</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>tid</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>PTHREAD_ITEM</name></type> <name>threadPtr</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>lstThread</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>threadPtr</name> <operator>=</operator> <operator>(</operator><name>PTHREAD_ITEM</name><operator>)</operator><name>lstThread</name></expr>;</expr_stmt>

<while>while <condition>(<expr><name><name>threadPtr</name><operator>-&gt;</operator><name>tid</name></name> <operator>!=</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name><name>threadPtr</name><operator>-&gt;</operator><name>pid</name></name> <operator>==</operator> <name>pid</name></expr>)</condition> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name><name>threadPtr</name><operator>-&gt;</operator><name>tid</name></name> <operator>==</operator> <name>tid</name></expr>)</condition> <block>{<block_content>

<return>return <expr><operator>(</operator><operator>(</operator><name>void</name><operator>*</operator><operator>)</operator><name>threadPtr</name><operator>)</operator></expr>;</return>

</block_content>}</block></if></if_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>threadPtr</name> <operator>=</operator> <operator>(</operator><name>PTHREAD_ITEM</name><operator>)</operator><operator>(</operator><operator>(</operator><name>ULONG_PTR</name><operator>)</operator><name>threadPtr</name> <operator>+</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>THREAD_ITEM</name></expr></argument>)</argument_list></sizeof><operator>)</operator></expr>;</expr_stmt>

</block_content>}</block></while>

</block_content>}</block></if></if_stmt>

<return>return <expr><name>NULL</name></expr>;</return>

</block_content>}</block></function>

<function><type><name>int</name></type> <name>w32_dbg_wait</name><parameter_list>(<parameter><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>pid</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>DEBUG_EVENT</name></type> <name>de</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>tid</name></decl>, <decl><type ref="prev"/><name>next_event</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>unsigned</name> <name>int</name></type> <name>code</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>char</name> <modifier>*</modifier></type><name>dllname</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>ret</name> <init>= <expr><name>R_DEBUG_REASON_UNKNOWN</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><specifier>static</specifier> <name>int</name></type> <name>exited_already</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<do>do <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name>exited_already</name> <operator>==</operator> <name>pid</name></expr>)</condition> <block>{<block_content>

<return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>memset</name> <argument_list>(<argument><expr><operator>&amp;</operator><name>de</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><sizeof>sizeof <argument_list>(<argument><expr><name>DEBUG_EVENT</name></expr></argument>)</argument_list></sizeof></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><call><name>WaitForDebugEvent</name> <argument_list>(<argument><expr><operator>&amp;</operator><name>de</name></expr></argument>, <argument><expr><name>INFINITE</name></expr></argument>)</argument_list></call> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_dbg_wait/WaitForDebugEvent"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>code</name> <operator>=</operator> <name><name>de</name><operator>.</operator><name>dwDebugEventCode</name></name></expr>;</expr_stmt>

<expr_stmt><expr><name>tid</name> <operator>=</operator> <name><name>de</name><operator>.</operator><name>dwThreadId</name></name></expr>;</expr_stmt>

<expr_stmt><expr><name>pid</name> <operator>=</operator> <name><name>de</name><operator>.</operator><name>dwProcessId</name></name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>dbg</name><operator>-&gt;</operator><name>tid</name></name> <operator>=</operator> <name>tid</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>dbg</name><operator>-&gt;</operator><name>pid</name></name> <operator>=</operator> <name>pid</name></expr>;</expr_stmt>

<switch>switch <condition>(<expr><name>code</name></expr>)</condition> <block>{<block_content>

<case>case <expr><name>CREATE_PROCESS_DEBUG_EVENT</name></expr>:</case>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"(%d) created process (%d:%p)\n"</literal></expr></argument>,

<argument><expr><name>pid</name></expr></argument>, <argument><expr><call><name>w32_h2t</name> <argument_list>(<argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateProcessInfo</name><operator>.</operator><name>hProcess</name></name></expr></argument>)</argument_list></call></expr></argument>,

<argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateProcessInfo</name><operator>.</operator><name>lpStartAddress</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_debug_native_continue</name> <argument_list>(<argument><expr><name>dbg</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_NEW_PID</name></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>EXIT_PROCESS_DEBUG_EVENT</name></expr>:</case>

<expr_stmt><expr><call><name>r_cons_printf</name> <argument_list>(<argument><expr><literal type="string">"(%d) Process %d exited with exit code %d\n"</literal></expr></argument>, <argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>.</operator><name>dwProcessId</name></name></expr></argument>, <argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>.</operator><name>dwProcessId</name></name></expr></argument>,

<argument><expr><operator>(</operator><name>int</name><operator>)</operator><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>ExitProcess</name><operator>.</operator><name>dwExitCode</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_cons_flush</name> <argument_list>()</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<expr_stmt><expr><name>exited_already</name> <operator>=</operator> <name>pid</name></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_EXIT_PID</name></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>CREATE_THREAD_DEBUG_EVENT</name></expr>:</case>

<expr_stmt><expr><call><name>r_debug_lstThreadAdd</name> <argument_list>(<argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateThread</name><operator>.</operator><name>hThread</name></name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateThread</name><operator>.</operator><name>lpThreadLocalBase</name></name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateThread</name><operator>.</operator><name>lpStartAddress</name></name></expr></argument>, <argument><expr><name>FALSE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_NEW_TID</name></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>EXIT_THREAD_DEBUG_EVENT</name></expr>:</case>

<expr_stmt><expr><name>lstThreadPtr</name> <operator>=</operator> <operator>(</operator><name>PTHREAD_ITEM</name><operator>)</operator><call><name>r_debug_findthread</name> <argument_list>(<argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>lstThreadPtr</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>bFinished</name></name> <operator>=</operator> <name>TRUE</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>lstThreadPtr</name><operator>-&gt;</operator><name>dwExitCode</name></name> <operator>=</operator> <name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>ExitThread</name><operator>.</operator><name>dwExitCode</name></name></expr>;</expr_stmt>

</block_content>}</block></if> <else>else <block>{<block_content>

<expr_stmt><expr><call><name>r_debug_lstThreadAdd</name> <argument_list>(<argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateThread</name><operator>.</operator><name>hThread</name></name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateThread</name><operator>.</operator><name>lpThreadLocalBase</name></name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>CreateThread</name><operator>.</operator><name>lpStartAddress</name></name></expr></argument>, <argument><expr><name>TRUE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></else></if_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_EXIT_TID</name></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>LOAD_DLL_DEBUG_EVENT</name></expr>:</case>

<expr_stmt><expr><name>dllname</name> <operator>=</operator> <call><name>get_file_name_from_handle</name> <argument_list>(<argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>LoadDll</name><operator>.</operator><name>hFile</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_debug_lstLibAdd</name> <argument_list>(<argument><expr><name>pid</name></expr></argument>,<argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>LoadDll</name><operator>.</operator><name>lpBaseOfDll</name></name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>LoadDll</name><operator>.</operator><name>hFile</name></name></expr></argument>, <argument><expr><name>dllname</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>dllname</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>dllname</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_NEW_LIB</name></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>UNLOAD_DLL_DEBUG_EVENT</name></expr>:</case>

<expr_stmt><expr><name>lstLibPtr</name> <operator>=</operator> <operator>(</operator><name>PLIB_ITEM</name><operator>)</operator><call><name>r_debug_findlib</name> <argument_list>(<argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>UnloadDll</name><operator>.</operator><name>lpBaseOfDll</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>lstLibPtr</name> <operator>!=</operator> <name>NULL</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name><name>lstLibPtr</name><operator>-&gt;</operator><name>hFile</name></name> <operator>=</operator> <operator>(</operator><name>HANDLE</name><operator>)</operator><operator>-</operator><literal type="number">1</literal></expr>;</expr_stmt>

</block_content>}</block></if> <else>else <block>{<block_content>

<expr_stmt><expr><call><name>r_debug_lstLibAdd</name> <argument_list>(<argument><expr><name>pid</name></expr></argument>, <argument><expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>UnloadDll</name><operator>.</operator><name>lpBaseOfDll</name></name></expr></argument>, <argument><expr><operator>(</operator><name>HANDLE</name><operator>)</operator><operator>-</operator><literal type="number">1</literal></expr></argument>, <argument><expr><literal type="string">"not cached"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>dllname</name></expr>)</condition><block type="pseudo"><block_content>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>dllname</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>

</block_content>}</block></else></if_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_EXIT_LIB</name></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>OUTPUT_DEBUG_STRING_EVENT</name></expr>:</case>

<expr_stmt><expr><call><name>r_cons_printf</name> <argument_list>(<argument><expr><literal type="string">"(%d) Debug string\n"</literal></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_cons_flush</name> <argument_list>()</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_debug_native_continue</name> <argument_list>(<argument><expr><name>dbg</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>RIP_EVENT</name></expr>:</case>

<expr_stmt><expr><call><name>r_cons_printf</name> <argument_list>(<argument><expr><literal type="string">"(%d) RIP event\n"</literal></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_cons_flush</name> <argument_list>()</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_debug_native_continue</name> <argument_list>(<argument><expr><name>dbg</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt>

<break>break;</break>

<case>case <expr><name>EXCEPTION_DEBUG_EVENT</name></expr>:</case>

<switch>switch <condition>(<expr><name><name>de</name><operator>.</operator><name>u</name><operator>.</operator><name>Exception</name><operator>.</operator><name>ExceptionRecord</name><operator>.</operator><name>ExceptionCode</name></name></expr>)</condition> <block>{<block_content>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><name>_WIN64</name></expr></cpp:if>

<case>case <expr><literal type="number">0x4000001f</literal></expr>:</case> 

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<case>case <expr><name>EXCEPTION_BREAKPOINT</name></expr>:</case>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_BREAKPOINT</name></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<break>break;</break>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><name>_WIN64</name></expr></cpp:if>

<case>case <expr><literal type="number">0x4000001e</literal></expr>:</case> 

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<case>case <expr><name>EXCEPTION_SINGLE_STEP</name></expr>:</case>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_STEP</name></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<break>break;</break>

<default>default:</default>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>debug_exception_event</name> <argument_list>(<argument><expr><operator>&amp;</operator><name>de</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>R_DEBUG_REASON_TRAP</name></expr>;</expr_stmt>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

</block_content>}</block></if>

<else>else <block>{<block_content>

<expr_stmt><expr><name>next_event</name> <operator>=</operator> <literal type="number">1</literal></expr>;</expr_stmt>

<expr_stmt><expr><call><name>r_debug_native_continue</name> <argument_list>(<argument><expr><name>dbg</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>, <argument><expr><operator>-</operator><literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></else></if_stmt>

</block_content>}</block></switch>

<break>break;</break>

<default>default:</default>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"(%d) unknown event: %d\n"</literal></expr></argument>, <argument><expr><name>pid</name></expr></argument>, <argument><expr><name>code</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><operator>-</operator><literal type="number">1</literal></expr>;</return>

</block_content>}</block></switch>

</block_content>}</block> while <condition>(<expr><name>next_event</name></expr>)</condition>;</do>

<return>return <expr><name>ret</name></expr>;</return>

</block_content>}</block></function>

<function><type><name>bool</name></type> <name>is_pe_hdr</name><parameter_list>(<parameter><decl><type><name>unsigned</name> <name>char</name> <modifier>*</modifier></type><name>pe_hdr</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>IMAGE_DOS_HEADER</name> <modifier>*</modifier></type><name>dos_header</name> <init>= <expr><operator>(</operator><name>IMAGE_DOS_HEADER</name> <operator>*</operator><operator>)</operator><name>pe_hdr</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>IMAGE_NT_HEADERS</name> <modifier>*</modifier></type><name>nt_headers</name></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name><name>dos_header</name><operator>-&gt;</operator><name>e_magic</name></name> <operator>==</operator> <name>IMAGE_DOS_SIGNATURE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>nt_headers</name> <operator>=</operator> <operator>(</operator><name>IMAGE_NT_HEADERS</name> <operator>*</operator><operator>)</operator><operator>(</operator><operator>(</operator><name>char</name> <operator>*</operator><operator>)</operator><name>dos_header</name>

<operator>+</operator> <name><name>dos_header</name><operator>-&gt;</operator><name>e_lfanew</name></name><operator>)</operator></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name><name>nt_headers</name><operator>-&gt;</operator><name>Signature</name></name> <operator>==</operator> <name>IMAGE_NT_SIGNATURE</name></expr>)</condition><block type="pseudo"><block_content>

<return>return <expr><name>true</name></expr>;</return></block_content></block></if></if_stmt>

</block_content>}</block></if></if_stmt>

<return>return <expr><name>false</name></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>HANDLE</name></type> <name>w32_open_thread</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>pid</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>tid</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>thread</name> <init>= <expr><call><name>w32_OpenThread</name> <argument_list>(<argument><expr><name>THREAD_ALL_ACCESS</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name>tid</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>thread</name> <operator>==</operator> <name>INVALID_HANDLE_VALUE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_open_thread/OpenThread"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<return>return <expr><name>thread</name></expr>;</return>

</block_content>}</block></function>

<function><type><name>RList</name> <modifier>*</modifier></type><name>w32_thread_list</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>pid</name></decl></parameter>, <parameter><decl><type><name>RList</name> <modifier>*</modifier></type><name>list</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>th</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>thid</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>THREADENTRY32</name></type> <name>te32</name></decl>;</decl_stmt>

<expr_stmt><expr><name><name>te32</name><operator>.</operator><name>dwSize</name></name> <operator>=</operator> <sizeof>sizeof<argument_list>(<argument><expr><name>THREADENTRY32</name></expr></argument>)</argument_list></sizeof></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>w32_OpenThread</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name><argument_list>(<argument><expr><literal type="string">"w32_thread_list: no w32_OpenThread?\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>list</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>th</name> <operator>=</operator> <call><name>CreateToolhelp32Snapshot</name><argument_list>(<argument><expr><name>TH32CS_SNAPTHREAD</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if<condition>(<expr><name>th</name> <operator>==</operator> <name>INVALID_HANDLE_VALUE</name> <operator>||</operator> <operator>!</operator><call><name>Thread32First</name> <argument_list>(<argument><expr><name>th</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>te32</name></expr></argument>)</argument_list></call></expr>)</condition><block type="pseudo"><block_content>

<goto>goto <name>err_load_th</name>;</goto></block_content></block></if></if_stmt>

<do>do <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name><name>te32</name><operator>.</operator><name>th32OwnerProcessID</name></name> <operator>==</operator> <name>pid</name></expr>)</condition> <block>{<block_content>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><literal type="number">0</literal></expr></cpp:if>

75 typedef struct tagTHREADENTRY32 {

76 DWORD dwSize;

77 DWORD cntUsage;

78 DWORD th32ThreadID;

79 DWORD th32OwnerProcessID;

80 LONG tpBasePri;

81 LONG tpDeltaPri;

82 DWORD dwFlags;

83 };

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<expr_stmt><expr><name>thid</name> <operator>=</operator> <call><name>w32_OpenThread</name> <argument_list>(<argument><expr><name>THREAD_ALL_ACCESS</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name><name>te32</name><operator>.</operator><name>th32ThreadID</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>thid</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_thread_list/OpenThread"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_load_th</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>r_list_append</name> <argument_list>(<argument><expr><name>list</name></expr></argument>, <argument><expr><call><name>r_debug_pid_new</name> <argument_list>(<argument><expr><literal type="string">"???"</literal></expr></argument>, <argument><expr><name><name>te32</name><operator>.</operator><name>th32ThreadID</name></name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="char">'s'</literal></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

</block_content>}</block> while <condition>(<expr><call><name>Thread32Next</name> <argument_list>(<argument><expr><name>th</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>te32</name></expr></argument>)</argument_list></call></expr>)</condition>;</do>

<label><name>err_load_th</name>:</label>

<if_stmt><if>if<condition>(<expr><name>th</name> <operator>!=</operator> <name>INVALID_HANDLE_VALUE</name></expr>)</condition><block type="pseudo"><block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>th</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if></if_stmt>

<return>return <expr><name>list</name></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>RDebugPid</name> <modifier>*</modifier></type><name>build_debug_pid</name><parameter_list>(<parameter><decl><type><name>PROCESSENTRY32</name> <modifier>*</modifier></type><name>pe</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>TCHAR</name></type> <name><name>image_name</name><index>[<expr><name>MAX_PATH</name> <operator>+</operator> <literal type="number">1</literal></expr>]</index></name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>length</name> <init>= <expr><name>MAX_PATH</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>RDebugPid</name> <modifier>*</modifier></type><name>ret</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>char</name> <modifier>*</modifier></type><name>name</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>process</name> <init>= <expr><call><name>w32_OpenProcess</name> <argument_list>(<argument><expr><literal type="number">0x1000</literal></expr></argument>, 

<argument><expr><name>FALSE</name></expr></argument>, <argument><expr><name><name>pe</name><operator>-&gt;</operator><name>th32ProcessID</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<expr_stmt><expr><operator>*</operator><name>image_name</name> <operator>=</operator> <literal type="char">'\0'</literal></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>process</name></expr>)</condition> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name>w32_QueryFullProcessImageName</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>w32_QueryFullProcessImageName</name> <argument_list>(<argument><expr><name>process</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name>image_name</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>length</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>CloseHandle</name><argument_list>(<argument><expr><name>process</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>*</operator><name>image_name</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>name</name> <operator>=</operator> <call><name>r_sys_conv_win_to_utf8</name> <argument_list>(<argument><expr><name>image_name</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if> <else>else <block>{<block_content>

<expr_stmt><expr><name>name</name> <operator>=</operator> <call><name>r_sys_conv_win_to_utf8</name> <argument_list>(<argument><expr><name><name>pe</name><operator>-&gt;</operator><name>szExeFile</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></else></if_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <call><name>r_debug_pid_new</name> <argument_list>(<argument><expr><name>name</name></expr></argument>, <argument><expr><name><name>pe</name><operator>-&gt;</operator><name>th32ProcessID</name></name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><literal type="char">'s'</literal></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>name</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>ret</name></expr>;</return>

</block_content>}</block></function>

<function><type><name>RList</name> <modifier>*</modifier></type><name>w32_pids</name><parameter_list>(<parameter><decl><type><name>int</name></type> <name>pid</name></decl></parameter>, <parameter><decl><type><name>RList</name> <modifier>*</modifier></type><name>list</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>process_snapshot</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>PROCESSENTRY32</name></type> <name>pe</name></decl>;</decl_stmt>

<expr_stmt><expr><name><name>pe</name><operator>.</operator><name>dwSize</name></name> <operator>=</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>PROCESSENTRY32</name></expr></argument>)</argument_list></sizeof></expr>;</expr_stmt>

<decl_stmt><decl><type><name>bool</name></type> <name>show_all_pids</name> <init>= <expr><name>pid</name> <operator>==</operator> <literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<expr_stmt><expr><name>process_snapshot</name> <operator>=</operator> <call><name>CreateToolhelp32Snapshot</name> <argument_list>(<argument><expr><name>TH32CS_SNAPPROCESS</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>process_snapshot</name> <operator>==</operator> <name>INVALID_HANDLE_VALUE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_pids/CreateToolhelp32Snapshot"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>list</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>Process32First</name> <argument_list>(<argument><expr><name>process_snapshot</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>pe</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_pids/Process32First"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>process_snapshot</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>list</name></expr>;</return>

</block_content>}</block></if></if_stmt>

<do>do <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name>show_all_pids</name> <operator>||</operator>

<name><name>pe</name><operator>.</operator><name>th32ProcessID</name></name> <operator>==</operator> <name>pid</name> <operator>||</operator>

<name><name>pe</name><operator>.</operator><name>th32ParentProcessID</name></name> <operator>==</operator> <name>pid</name></expr>)</condition> <block>{<block_content>

<decl_stmt><decl><type><name>RDebugPid</name> <modifier>*</modifier></type><name>debug_pid</name> <init>= <expr><call><name>build_debug_pid</name> <argument_list>(<argument><expr><operator>&amp;</operator><name>pe</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>debug_pid</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_list_append</name> <argument_list>(<argument><expr><name>list</name></expr></argument>, <argument><expr><name>debug_pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

</block_content>}</block></if></if_stmt>

</block_content>}</block> while <condition>(<expr><call><name>Process32Next</name> <argument_list>(<argument><expr><name>process_snapshot</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>pe</name></expr></argument>)</argument_list></call></expr>)</condition>;</do>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>process_snapshot</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>list</name></expr>;</return>

</block_content>}</block></function>

<function><type><name>bool</name></type> <name>w32_terminate_process</name><parameter_list>(<parameter><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>pid</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>h_proc</name> <init>= <expr><call><name>w32_OpenProcess</name><argument_list>(<argument><expr><name>PROCESS_TERMINATE</name> <operator>|</operator> <name>SYNCHRONIZE</name></expr></argument> , <argument><expr><name>FALSE</name></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>bool</name></type> <name>ret</name> <init>= <expr><name>false</name></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_terminate_process/OpenProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_terminate_process</name>;</goto>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><name>w32_DebugActiveProcessStop</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>w32_DebugActiveProcessStop</name> <argument_list>(<argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt> 

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><call><name>TerminateProcess</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>, <argument><expr><literal type="number">1</literal></expr></argument>)</argument_list></call> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"e32_terminate_process/TerminateProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_terminate_process</name>;</goto>

</block_content>}</block></if></if_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>ret_wait</name> <init>= <expr><call><name>WaitForSingleObject</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>, <argument><expr><literal type="number">1000</literal></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>ret_wait</name> <operator>==</operator> <name>WAIT_FAILED</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_terminate_process/WaitForSingleObject"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_terminate_process</name>;</goto>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><name>ret_wait</name> <operator>==</operator> <name>WAIT_TIMEOUT</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"(%d) Waiting for process to terminate timed out.\n"</literal></expr></argument>, <argument><expr><name>pid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_terminate_process</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <name>true</name></expr>;</expr_stmt>

<label><name>err_w32_terminate_process</name>:</label>

<if_stmt><if>if <condition>(<expr><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<return>return <expr><name>ret</name></expr>;</return>

</block_content>}</block></function>

<function><type><name>void</name></type> <name>w32_break_process</name><parameter_list>(<parameter><decl><type><name>void</name> <modifier>*</modifier></type><name>d</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name> <init>= <expr><operator>(</operator><name>RDebug</name> <operator>*</operator><operator>)</operator><name>d</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>h_proc</name> <init>= <expr><call><name>w32_OpenProcess</name> <argument_list>(<argument><expr><name>PROCESS_ALL_ACCESS</name></expr></argument>, <argument><expr><name>FALSE</name></expr></argument>, <argument><expr><name><name>dbg</name><operator>-&gt;</operator><name>pid</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_break_process/w32_OpenProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_break_process</name>;</goto>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>w32_DebugBreakProcess</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_break_process/w32_DebugBreakProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_break_process</name>;</goto>

</block_content>}</block></if></if_stmt>

<label><name>err_w32_break_process</name>:</label>

<if_stmt><if>if <condition>(<expr><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>int</name></type> <name>GetAVX</name><parameter_list>(<parameter><decl><type><name>HANDLE</name></type> <name>hThread</name></decl></parameter>, <parameter><decl><type><name>ut128</name></type> <name><name>xmm</name><index>[<expr><literal type="number">16</literal></expr>]</index></name></decl></parameter>, <parameter><decl><type><name>ut128</name></type> <name><name>ymm</name><index>[<expr><literal type="number">16</literal></expr>]</index></name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>BOOL</name></type> <name>Success</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>nRegs</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>, <decl><type ref="prev"/><name>Index</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>ContextSize</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>FeatureLength</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>ut64</name></type> <name>FeatureMask</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>ut128</name> <modifier>*</modifier></type> <name>Xmm</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>ut128</name> <modifier>*</modifier></type> <name>Ymm</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>void</name> <modifier>*</modifier></type> <name>buffer</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>PCONTEXT</name></type> <name>Context</name></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>w32_GetEnabledXStateFeatures</name> <operator>==</operator> <operator>(</operator><call><call><name>ut64</name> <argument_list>(<argument><expr><name>WINAPI</name> <operator>*</operator></expr></argument>)</argument_list></call> <argument_list>()</argument_list></call><operator>)</operator><operator>-</operator><literal type="number">1</literal></expr>)</condition> <block>{<block_content>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>FeatureMask</name> <operator>=</operator> <call><name>w32_GetEnabledXStateFeatures</name><argument_list>()</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>(</operator><name>FeatureMask</name> <operator>&amp;</operator> <name>XSTATE_MASK_AVX</name><operator>)</operator> <operator>==</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>Success</name> <operator>=</operator> <call><name>w32_InitializeContext</name><argument_list>(<argument><expr><name>NULL</name></expr></argument>, <argument><expr><name>CONTEXT_ALL</name> <operator>|</operator> <name>CONTEXT_XSTATE</name></expr></argument>, <argument><expr><name>NULL</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>ContextSize</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>(</operator><name>Success</name> <operator>==</operator> <name>TRUE</name><operator>)</operator> <operator>||</operator> <operator>(</operator><call><name>GetLastError</name><argument_list>()</argument_list></call> <operator>!=</operator> <name>ERROR_INSUFFICIENT_BUFFER</name><operator>)</operator></expr>)</condition> <block>{<block_content>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>buffer</name> <operator>=</operator> <call><name>malloc</name><argument_list>(<argument><expr><name>ContextSize</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>buffer</name> <operator>==</operator> <name>NULL</name></expr>)</condition> <block>{<block_content>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>Success</name> <operator>=</operator> <call><name>w32_InitializeContext</name><argument_list>(<argument><expr><name>buffer</name></expr></argument>, <argument><expr><name>CONTEXT_ALL</name> <operator>|</operator> <name>CONTEXT_XSTATE</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>Context</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>ContextSize</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>Success</name> <operator>==</operator> <name>FALSE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>free</name><argument_list>(<argument><expr><name>buffer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>Success</name> <operator>=</operator> <call><name>w32_SetXStateFeaturesMask</name><argument_list>(<argument><expr><name>Context</name></expr></argument>, <argument><expr><name>XSTATE_MASK_AVX</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>Success</name> <operator>==</operator> <name>FALSE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>free</name><argument_list>(<argument><expr><name>buffer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>Success</name> <operator>=</operator> <call><name>GetThreadContext</name><argument_list>(<argument><expr><name>hThread</name></expr></argument>, <argument><expr><name>Context</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>Success</name> <operator>==</operator> <name>FALSE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>free</name><argument_list>(<argument><expr><name>buffer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>Success</name> <operator>=</operator> <call><name>w32_GetXStateFeaturesMask</name><argument_list>(<argument><expr><name>Context</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>FeatureMask</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>Success</name> <operator>==</operator> <name>FALSE</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>free</name><argument_list>(<argument><expr><name>buffer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><literal type="number">0</literal></expr>;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>Xmm</name> <operator>=</operator> <operator>(</operator><name>ut128</name> <operator>*</operator><operator>)</operator><call><name>w32_LocateXStateFeature</name><argument_list>(<argument><expr><name>Context</name></expr></argument>, <argument><expr><name>XSTATE_LEGACY_SSE</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>FeatureLength</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>nRegs</name> <operator>=</operator> <name>FeatureLength</name> <operator>/</operator> <sizeof>sizeof<argument_list>(<argument><expr><operator>*</operator><name>Xmm</name></expr></argument>)</argument_list></sizeof></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>Index</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>Index</name> <operator>&lt;</operator> <name>nRegs</name></expr>;</condition> <incr><expr><name>Index</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>ymm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>High</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<expr_stmt><expr><name><name>xmm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>High</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<expr_stmt><expr><name><name>ymm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>Low</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<expr_stmt><expr><name><name>xmm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>Low</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

</block_content>}</block></for>

<if_stmt><if>if <condition>(<expr><name>Xmm</name> <operator>!=</operator> <name>NULL</name></expr>)</condition> <block>{<block_content>

<for>for <control>(<init><expr><name>Index</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>Index</name> <operator>&lt;</operator> <name>nRegs</name></expr>;</condition> <incr><expr><name>Index</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>xmm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>High</name> <operator>=</operator> <name><name>Xmm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>High</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>xmm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>Low</name> <operator>=</operator> <name><name>Xmm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>Low</name></expr>;</expr_stmt>

</block_content>}</block></for>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>(</operator><name>FeatureMask</name> <operator>&amp;</operator> <name>XSTATE_MASK_AVX</name><operator>)</operator> <operator>!=</operator> <literal type="number">0</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>Ymm</name> <operator>=</operator> <operator>(</operator><name>ut128</name> <operator>*</operator><operator>)</operator><call><name>w32_LocateXStateFeature</name><argument_list>(<argument><expr><name>Context</name></expr></argument>, <argument><expr><name>XSTATE_AVX</name></expr></argument>, <argument><expr><name>NULL</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>Index</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>Index</name> <operator>&lt;</operator> <name>nRegs</name></expr>;</condition> <incr><expr><name>Index</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>ymm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>High</name> <operator>=</operator> <name><name>Ymm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>High</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>ymm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>Low</name> <operator>=</operator> <name><name>Ymm</name><index>[<expr><name>Index</name></expr>]</index></name><operator>.</operator><name>Low</name></expr>;</expr_stmt>

</block_content>}</block></for>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>free</name><argument_list>(<argument><expr><name>buffer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>nRegs</name></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>void</name></type> <name>printwincontext</name><parameter_list>(<parameter><decl><type><name>HANDLE</name></type> <name>hThread</name></decl></parameter>, <parameter><decl><type><name>CONTEXT</name> <modifier>*</modifier></type> <name>ctx</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>ut128</name></type> <name><name>xmm</name><index>[<expr><literal type="number">16</literal></expr>]</index></name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>ut128</name></type> <name><name>ymm</name><index>[<expr><literal type="number">16</literal></expr>]</index></name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>ut80</name></type> <name><name>st</name><index>[<expr><literal type="number">8</literal></expr>]</index></name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>ut64</name></type> <name><name>mm</name><index>[<expr><literal type="number">8</literal></expr>]</index></name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>ut16</name></type> <name>top</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>x</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>, <decl><type ref="prev"/><name>nxmm</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>, <decl><type ref="prev"/><name>nymm</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><name>_WIN64</name></expr></cpp:if>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"ControlWord = %08x StatusWord = %08x\n"</literal></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>ControlWord</name></name></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>StatusWord</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"MxCsr = %08x TagWord = %08x\n"</literal></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>MxCsr</name></name></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>TagWord</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"ErrorOffset = %08x DataOffset = %08x\n"</literal></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>ErrorOffset</name></name></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>DataOffset</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"ErrorSelector = %08x DataSelector = %08x\n"</literal></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>ErrorSelector</name></name></expr></argument>, <argument><expr><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>DataSelector</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">8</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>st</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name> <operator>=</operator> <name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>FloatRegisters</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>st</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name> <operator>=</operator> <operator>(</operator><name>ut16</name><operator>)</operator><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>FloatRegisters</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name></expr>;</expr_stmt>

</block_content>}</block></for>

<expr_stmt><expr><name>top</name> <operator>=</operator> <operator>(</operator><name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>StatusWord</name></name> <operator>&amp;</operator> <literal type="number">0x3fff</literal><operator>)</operator> <operator>&gt;&gt;</operator> <literal type="number">11</literal></expr>;</expr_stmt>

<expr_stmt><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">8</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>mm</name><index>[<expr><name>top</name></expr>]</index></name> <operator>=</operator> <name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>FloatRegisters</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name></expr>;</expr_stmt>

<expr_stmt><expr><name>top</name><operator>++</operator></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>top</name> <operator>&gt;</operator> <literal type="number">7</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>top</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

</block_content>}</block></for>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">16</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>xmm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name> <operator>=</operator> <name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>XmmRegisters</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>xmm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name> <operator>=</operator> <name><name>ctx</name><operator>-&gt;</operator><name>FltSave</name><operator>.</operator><name>XmmRegisters</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name></expr>;</expr_stmt>

</block_content>}</block></for>

<expr_stmt><expr><name>nxmm</name> <operator>=</operator> <literal type="number">16</literal></expr>;</expr_stmt>

<cpp:else>#<cpp:directive>else</cpp:directive></cpp:else>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"ControlWord = %08x StatusWord = %08x\n"</literal></expr></argument>, <argument><expr><operator>(</operator><name>ut32</name><operator>)</operator> <name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>ControlWord</name></name></expr></argument>, <argument><expr><operator>(</operator><name>ut32</name><operator>)</operator> <name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>StatusWord</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"MxCsr = %08x TagWord = %08x\n"</literal></expr></argument>, <argument><expr><operator>*</operator><operator>(</operator><name>ut32</name> <operator>*</operator><operator>)</operator><operator>&amp;</operator><name><name>ctx</name><operator>-&gt;</operator><name>ExtendedRegisters</name><index>[<expr><literal type="number">24</literal></expr>]</index></name></expr></argument>, <argument><expr><operator>(</operator><name>ut32</name><operator>)</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>TagWord</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"ErrorOffset = %08x DataOffset = %08x\n"</literal></expr></argument>, <argument><expr><operator>(</operator><name>ut32</name><operator>)</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>ErrorOffset</name></name></expr></argument>, <argument><expr><operator>(</operator><name>ut32</name><operator>)</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>DataOffset</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"ErrorSelector = %08x DataSelector = %08x\n"</literal></expr></argument>, <argument><expr><operator>(</operator><name>ut32</name><operator>)</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>ErrorSelector</name></name></expr></argument>, <argument><expr><operator>(</operator><name>ut32</name><operator>)</operator> <name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>DataSelector</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">8</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>st</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name> <operator>=</operator> <operator>(</operator><name>ut16</name><operator>)</operator> <operator>*</operator><operator>(</operator><operator>(</operator><name>ut16</name> <operator>*</operator><operator>)</operator><operator>(</operator><operator>&amp;</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>RegisterArea</name><index>[<expr><name>x</name> <operator>*</operator> <literal type="number">10</literal></expr>]</index></name> <operator>+</operator> <literal type="number">8</literal><operator>)</operator><operator>)</operator></expr>;</expr_stmt>

<expr_stmt><expr><name><name>st</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name> <operator>=</operator> <operator>(</operator><name>ut64</name><operator>)</operator> <operator>*</operator><operator>(</operator><operator>(</operator><name>ut64</name> <operator>*</operator><operator>)</operator><operator>&amp;</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>RegisterArea</name><index>[<expr><name>x</name> <operator>*</operator> <literal type="number">10</literal></expr>]</index></name><operator>)</operator></expr>;</expr_stmt>

</block_content>}</block></for>

<expr_stmt><expr><name>top</name> <operator>=</operator> <operator>(</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>StatusWord</name></name> <operator>&amp;</operator> <literal type="number">0x3fff</literal><operator>)</operator> <operator>&gt;&gt;</operator> <literal type="number">11</literal></expr>;</expr_stmt>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">8</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>mm</name><index>[<expr><name>top</name></expr>]</index></name> <operator>=</operator> <operator>*</operator><operator>(</operator><operator>(</operator><name>ut64</name> <operator>*</operator><operator>)</operator><operator>&amp;</operator><name><name>ctx</name><operator>-&gt;</operator><name>FloatSave</name><operator>.</operator><name>RegisterArea</name><index>[<expr><name>x</name> <operator>*</operator> <literal type="number">10</literal></expr>]</index></name><operator>)</operator></expr>;</expr_stmt>

<expr_stmt><expr><name>top</name><operator>++</operator></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>top</name><operator>&gt;</operator><literal type="number">7</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>top</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

</block_content>}</block></for>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">8</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><name><name>xmm</name><index>[<expr><name>x</name></expr>]</index></name> <operator>=</operator> <operator>*</operator><operator>(</operator><operator>(</operator><name>ut128</name> <operator>*</operator><operator>)</operator><operator>&amp;</operator><name><name>ctx</name><operator>-&gt;</operator><name>ExtendedRegisters</name><index>[<expr><operator>(</operator><literal type="number">10</literal> <operator>+</operator> <name>x</name><operator>)</operator> <operator>*</operator> <literal type="number">16</literal></expr>]</index></name><operator>)</operator></expr>;</expr_stmt>

</block_content>}</block></for>

<expr_stmt><expr><name>nxmm</name> <operator>=</operator> <literal type="number">8</literal></expr>;</expr_stmt>

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">8</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"ST%i %04x %016"</literal><name>PFMT64x</name><literal type="string">" (%f)\n"</literal></expr></argument>, <argument><expr><name>x</name></expr></argument>, <argument><expr><name><name>st</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name></expr></argument>, <argument><expr><name><name>st</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name></expr></argument>, <argument><expr><operator>(</operator><name>double</name><operator>)</operator><operator>(</operator><operator>*</operator><operator>(</operator><operator>(</operator><name>long</name> <name>double</name> <operator>*</operator><operator>)</operator><operator>&amp;</operator><name><name>st</name><index>[<expr><name>x</name></expr>]</index></name><operator>)</operator><operator>)</operator></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></for>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <literal type="number">8</literal></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"MM%i %016"</literal><name>PFMT64x</name><literal type="string">"\n"</literal></expr></argument>, <argument><expr><name>x</name></expr></argument>, <argument><expr><name><name>mm</name><index>[<expr><name>x</name></expr>]</index></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></for>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <name>nxmm</name></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"XMM%i %016"</literal><name>PFMT64x</name><literal type="string">" %016"</literal><name>PFMT64x</name><literal type="string">"\n"</literal></expr></argument>, <argument><expr><name>x</name></expr></argument>, <argument><expr><name><name>xmm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name></expr></argument>, <argument><expr><name><name>xmm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></for>

<expr_stmt><expr><name>nymm</name> <operator>=</operator> <call><name>GetAVX</name> <argument_list>(<argument><expr><name>hThread</name></expr></argument>, <argument><expr><name>xmm</name></expr></argument>, <argument><expr><name>ymm</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>nymm</name></expr>)</condition> <block>{<block_content>

<for>for <control>(<init><expr><name>x</name> <operator>=</operator> <literal type="number">0</literal></expr>;</init> <condition><expr><name>x</name> <operator>&lt;</operator> <name>nymm</name></expr>;</condition> <incr><expr><name>x</name><operator>++</operator></expr></incr>)</control> <block>{<block_content>

<expr_stmt><expr><call><name>eprintf</name> <argument_list>(<argument><expr><literal type="string">"Ymm%d: %016"</literal><name>PFMT64x</name><literal type="string">" %016"</literal><name>PFMT64x</name><literal type="string">" %016"</literal><name>PFMT64x</name><literal type="string">" %016"</literal><name>PFMT64x</name><literal type="string">"\n"</literal></expr></argument>, <argument><expr><name>x</name></expr></argument>, <argument><expr><name><name>ymm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name></expr></argument>, <argument><expr><name><name>ymm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name></expr></argument>, <argument><expr><name><name>xmm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>High</name></expr></argument>, <argument><expr><name><name>xmm</name><index>[<expr><name>x</name></expr>]</index></name><operator>.</operator><name>Low</name></expr></argument> )</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></for>

</block_content>}</block></if></if_stmt>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>int</name></type> <name>w32_reg_read</name><parameter_list>(<parameter><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>type</name></decl></parameter>, <parameter><decl><type><name>ut8</name> <modifier>*</modifier></type><name>buf</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>size</name></decl></parameter>)</parameter_list> <block>{<block_content>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><call><name>defined</name><argument_list>(<argument><expr><name>_MSC_VER</name></expr></argument>)</argument_list></call></expr></cpp:if>
<decl_stmt><decl><type><name>CONTEXT</name></type> <name>ctx</name></decl>;</decl_stmt>

<cpp:else>#<cpp:directive>else</cpp:directive></cpp:else>

<decl_stmt><decl><type><name>CONTEXT</name> <name>ctx</name></type> <name>__attribute__</name> <argument_list>(<argument><expr><operator>(</operator><call><name>aligned</name> <argument_list>(<argument><expr><literal type="number">16</literal></expr></argument>)</argument_list></call><operator>)</operator></expr></argument>)</argument_list></decl>;</decl_stmt>

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<decl_stmt><decl><type><name>int</name></type> <name>showfpu</name> <init>= <expr><name>false</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>pid</name> <init>= <expr><name><name>dbg</name><operator>-&gt;</operator><name>pid</name></name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>int</name></type> <name>tid</name> <init>= <expr><name><name>dbg</name><operator>-&gt;</operator><name>tid</name></name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>hThread</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><name>type</name> <operator>&lt;</operator> <operator>-</operator><literal type="number">1</literal></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>showfpu</name> <operator>=</operator> <name>true</name></expr>;</expr_stmt> 

<expr_stmt><expr><name>type</name> <operator>=</operator> <operator>-</operator><name>type</name></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>hThread</name> <operator>=</operator> <call><name>w32_open_thread</name> <argument_list>(<argument><expr><name>pid</name></expr></argument>, <argument><expr><name>tid</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>memset</name><argument_list>(<argument><expr><operator>&amp;</operator><name>ctx</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><sizeof>sizeof <argument_list>(<argument><expr><name>CONTEXT</name></expr></argument>)</argument_list></sizeof></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name><name>ctx</name><operator>.</operator><name>ContextFlags</name></name> <operator>=</operator> <name>CONTEXT_ALL</name></expr> ;</expr_stmt>

<if_stmt><if>if <condition>(<expr><call><name>GetThreadContext</name> <argument_list>(<argument><expr><name>hThread</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>ctx</name></expr></argument>)</argument_list></call> <operator>==</operator> <name>TRUE</name></expr>)</condition> <block>{<block_content>

<if_stmt><if>if <condition>(<expr><name>size</name> <operator>&gt;</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>CONTEXT</name></expr></argument>)</argument_list></sizeof></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>size</name> <operator>=</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>CONTEXT</name></expr></argument>)</argument_list></sizeof></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>memcpy</name> <argument_list>(<argument><expr><name>buf</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>ctx</name></expr></argument>, <argument><expr><name>size</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if> <else>else <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_reg_read/GetThreadContext"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>size</name> <operator>=</operator> <literal type="number">0</literal></expr>;</expr_stmt>

</block_content>}</block></else></if_stmt>

<if_stmt><if>if <condition>(<expr><name>showfpu</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>printwincontext</name> <argument_list>(<argument><expr><name>hThread</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>ctx</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>CloseHandle</name><argument_list>(<argument><expr><name>hThread</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>size</name></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>int</name></type> <name>w32_reg_write</name><parameter_list>(<parameter><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>type</name></decl></parameter>, <parameter><decl><type><specifier>const</specifier> <name>ut8</name><modifier>*</modifier></type> <name>buf</name></decl></parameter>, <parameter><decl><type><name>int</name></type> <name>size</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>BOOL</name></type> <name>ret</name> <init>= <expr><name>false</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>thread</name></decl>;</decl_stmt>

<cpp:if>#<cpp:directive>if</cpp:directive> <expr><name>_MSC_VER</name></expr></cpp:if>

<decl_stmt><decl><type><name>CONTEXT</name></type> <name>ctx</name></decl>;</decl_stmt>

<cpp:else>#<cpp:directive>else</cpp:directive></cpp:else>

<decl_stmt><decl><type><name>CONTEXT</name> <name>ctx</name></type> <name>__attribute__</name><argument_list>(<argument><expr><operator>(</operator><call><name>aligned</name> <argument_list>(<argument><expr><literal type="number">16</literal></expr></argument>)</argument_list></call><operator>)</operator></expr></argument>)</argument_list></decl>;</decl_stmt>

<cpp:endif>#<cpp:directive>endif</cpp:directive></cpp:endif>

<expr_stmt><expr><name>thread</name> <operator>=</operator> <call><name>w32_open_thread</name> <argument_list>(<argument><expr><name><name>dbg</name><operator>-&gt;</operator><name>pid</name></name></expr></argument>, <argument><expr><name><name>dbg</name><operator>-&gt;</operator><name>tid</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name><name>ctx</name><operator>.</operator><name>ContextFlags</name></name> <operator>=</operator> <name>CONTEXT_ALL</name></expr>;</expr_stmt>

<expr_stmt><expr><call><name>GetThreadContext</name> <argument_list>(<argument><expr><name>thread</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>ctx</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><name>size</name> <operator>&gt;</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>CONTEXT</name></expr></argument>)</argument_list></sizeof></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name>size</name> <operator>=</operator> <sizeof>sizeof <argument_list>(<argument><expr><name>CONTEXT</name></expr></argument>)</argument_list></sizeof></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>memcpy</name> <argument_list>(<argument><expr><operator>&amp;</operator><name>ctx</name></expr></argument>, <argument><expr><name>buf</name></expr></argument>, <argument><expr><name>size</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name>ret</name> <operator>=</operator> <operator>(</operator><name>bool</name><operator>)</operator><call><name>SetThreadContext</name> <argument_list>(<argument><expr><name>thread</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>ctx</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>thread</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>ret</name></expr>;</return>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>void</name></type> <name>w32_info_user</name><parameter_list>(<parameter><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name></decl></parameter>, <parameter><decl><type><name>RDebugInfo</name> <modifier>*</modifier></type><name>rdi</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>h_tok</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>tok_len</name> <init>= <expr><literal type="number">0</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>PTOKEN_USER</name></type> <name>tok_usr</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>LPTSTR</name></type> <name>usr</name> <init>= <expr><name>NULL</name></expr></init></decl>, <decl><type ref="prev"/><name>usr_dom</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>usr_len</name> <init>= <expr><literal type="number">512</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>usr_dom_len</name> <init>= <expr><literal type="number">512</literal></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>SID_NAME_USE</name></type> <name>snu</name> <init>= <expr><block>{<expr><literal type="number">0</literal></expr>}</block></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>h_proc</name> <init>= <expr><call><name>OpenProcess</name> <argument_list>(<argument><expr><name>PROCESS_QUERY_INFORMATION</name></expr></argument>, <argument><expr><name>FALSE</name></expr></argument>, <argument><expr><name><name>dbg</name><operator>-&gt;</operator><name>pid</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/OpenProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>OpenProcessToken</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>, <argument><expr><name>TOKEN_QUERY</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>h_tok</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/OpenProcessToken"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>GetTokenInformation</name> <argument_list>(<argument><expr><name>h_tok</name></expr></argument>, <argument><expr><name>TokenUser</name></expr></argument>, <argument><expr><operator>(</operator><name>LPVOID</name><operator>)</operator><operator>&amp;</operator><name>tok_usr</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><operator>&amp;</operator><name>tok_len</name></expr></argument>)</argument_list></call> <operator>&amp;&amp;</operator> <call><name>GetLastError</name> <argument_list>()</argument_list></call> <operator>!=</operator> <name>ERROR_INSUFFICIENT_BUFFER</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/GetTokenInformation"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>tok_usr</name> <operator>=</operator> <operator>(</operator><name>PTOKEN_USER</name><operator>)</operator><call><name>malloc</name> <argument_list>(<argument><expr><name>tok_len</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>tok_usr</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/malloc tok_usr"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>GetTokenInformation</name> <argument_list>(<argument><expr><name>h_tok</name></expr></argument>, <argument><expr><name>TokenUser</name></expr></argument>, <argument><expr><operator>(</operator><name>LPVOID</name><operator>)</operator><name>tok_usr</name></expr></argument>, <argument><expr><name>tok_len</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>tok_len</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/GetTokenInformation"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>usr</name> <operator>=</operator> <operator>(</operator><name>LPTSTR</name><operator>)</operator><call><name>malloc</name> <argument_list>(<argument><expr><name>usr_len</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>usr</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/malloc usr"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><operator>*</operator><name>usr</name> <operator>=</operator> <literal type="char">'\0'</literal></expr>;</expr_stmt>

<expr_stmt><expr><name>usr_dom</name> <operator>=</operator> <operator>(</operator><name>LPTSTR</name><operator>)</operator><call><name>malloc</name> <argument_list>(<argument><expr><name>usr_dom_len</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>usr_dom</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/malloc usr_dom"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><operator>*</operator><name>usr_dom</name> <operator>=</operator> <literal type="char">'\0'</literal></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><call><name>LookupAccountSid</name> <argument_list>(<argument><expr><name>NULL</name></expr></argument>, <argument><expr><name><name>tok_usr</name><operator>-&gt;</operator><name>User</name><operator>.</operator><name>Sid</name></name></expr></argument>, <argument><expr><name>usr</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>usr_len</name></expr></argument>, <argument><expr><name>usr_dom</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>usr_dom_len</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>snu</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_user/LookupAccountSid"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_user</name>;</goto>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><operator>*</operator><name>usr_dom</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>usr</name></name> <operator>=</operator> <call><name>r_str_newf</name> <argument_list>(<argument><expr><name>W32_TCHAR_FSTR</name><literal type="string">"\\"</literal><name>W32_TCHAR_FSTR</name></expr></argument>, <argument><expr><name>usr_dom</name></expr></argument>, <argument><expr><name>usr</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if> <else>else <block>{<block_content>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>usr</name></name> <operator>=</operator> <call><name>r_sys_conv_win_to_utf8</name> <argument_list>(<argument><expr><name>usr</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></else></if_stmt>

<label><name>err_w32_info_user</name>:</label>

<if_stmt><if>if <condition>(<expr><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<if_stmt><if>if <condition>(<expr><name>h_tok</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>h_tok</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>usr</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>usr_dom</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>tok_usr</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></function>

<function><type><specifier>static</specifier> <name>void</name></type> <name>w32_info_exe</name><parameter_list>(<parameter><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name></decl></parameter>, <parameter><decl><type><name>RDebugInfo</name> <modifier>*</modifier></type><name>rdi</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>LPTSTR</name></type> <name>path</name> <init>= <expr><name>NULL</name></expr></init></decl>;</decl_stmt>

<decl_stmt><decl><type><name>HANDLE</name></type> <name>h_proc</name></decl>;</decl_stmt>

<decl_stmt><decl><type><name>DWORD</name></type> <name>len</name></decl>;</decl_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>w32_QueryFullProcessImageName</name></expr>)</condition> <block>{<block_content>

<return>return;</return>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>h_proc</name> <operator>=</operator> <call><name>OpenProcess</name> <argument_list>(<argument><expr><name>PROCESS_QUERY_INFORMATION</name></expr></argument>, <argument><expr><name>FALSE</name></expr></argument>, <argument><expr><name><name>dbg</name><operator>-&gt;</operator><name>pid</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_exe/OpenProcess"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_exe</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>path</name> <operator>=</operator> <operator>(</operator><name>LPTSTR</name><operator>)</operator><call><name>malloc</name> <argument_list>(<argument><expr><name>MAX_PATH</name> <operator>+</operator> <literal type="number">1</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><operator>!</operator><name>path</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_exe/malloc path"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<goto>goto <name>err_w32_info_exe</name>;</goto>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><name>len</name> <operator>=</operator> <name>MAX_PATH</name></expr>;</expr_stmt>

<if_stmt><if>if <condition>(<expr><call><name>w32_QueryFullProcessImageName</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>, <argument><expr><literal type="number">0</literal></expr></argument>, <argument><expr><name>path</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>len</name></expr></argument>)</argument_list></call></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><name><name>path</name><index>[<expr><name>len</name></expr>]</index></name> <operator>=</operator> <literal type="char">'\0'</literal></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>exe</name></name> <operator>=</operator> <call><name>r_sys_conv_win_to_utf8</name> <argument_list>(<argument><expr><name>path</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if> <else>else <block>{<block_content>

<expr_stmt><expr><call><name>r_sys_perror</name> <argument_list>(<argument><expr><literal type="string">"w32_info_exe/QueryFullProcessImageName"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></else></if_stmt>

<label><name>err_w32_info_exe</name>:</label>

<if_stmt><if>if <condition>(<expr><name>h_proc</name></expr>)</condition> <block>{<block_content>

<expr_stmt><expr><call><name>CloseHandle</name> <argument_list>(<argument><expr><name>h_proc</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></if></if_stmt>

<expr_stmt><expr><call><name>free</name> <argument_list>(<argument><expr><name>path</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></function>

<function><type><name>RDebugInfo</name> <modifier>*</modifier></type><name>w32_info</name><parameter_list>(<parameter><decl><type><name>RDebug</name> <modifier>*</modifier></type><name>dbg</name></decl></parameter>, <parameter><decl><type><specifier>const</specifier> <name>char</name> <modifier>*</modifier></type><name>arg</name></decl></parameter>)</parameter_list> <block>{<block_content>

<decl_stmt><decl><type><name>RDebugInfo</name> <modifier>*</modifier></type><name>rdi</name> <init>= <expr><call><name>R_NEW0</name> <argument_list>(<argument><expr><name>RDebugInfo</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>status</name></name> <operator>=</operator> <name>R_DBG_PROC_SLEEP</name></expr>;</expr_stmt> 

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>pid</name></name> <operator>=</operator> <name><name>dbg</name><operator>-&gt;</operator><name>pid</name></name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>tid</name></name> <operator>=</operator> <name><name>dbg</name><operator>-&gt;</operator><name>tid</name></name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>lib</name></name> <operator>=</operator> <operator>(</operator><name>void</name> <operator>*</operator><operator>)</operator> <call><name>r_debug_get_lib_item</name><argument_list>()</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>thread</name></name> <operator>=</operator> <operator>(</operator><name>void</name> <operator>*</operator><operator>)</operator><call><name>r_debug_get_thread_item</name> <argument_list>()</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>uid</name></name> <operator>=</operator> <operator>-</operator><literal type="number">1</literal></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>gid</name></name> <operator>=</operator> <operator>-</operator><literal type="number">1</literal></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>cwd</name></name> <operator>=</operator> <name>NULL</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>exe</name></name> <operator>=</operator> <name>NULL</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>cmdline</name></name> <operator>=</operator> <name>NULL</name></expr>;</expr_stmt>

<expr_stmt><expr><name><name>rdi</name><operator>-&gt;</operator><name>libname</name></name> <operator>=</operator> <name>NULL</name></expr>;</expr_stmt>

<expr_stmt><expr><call><name>w32_info_user</name> <argument_list>(<argument><expr><name>dbg</name></expr></argument>, <argument><expr><name>rdi</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<expr_stmt><expr><call><name>w32_info_exe</name> <argument_list>(<argument><expr><name>dbg</name></expr></argument>, <argument><expr><name>rdi</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<return>return <expr><name>rdi</name></expr>;</return>

</block_content>}</block></function>

<cpp:include>#<cpp:directive>include</cpp:directive> <cpp:file>"maps/windows.c"</cpp:file></cpp:include>

</unit>
